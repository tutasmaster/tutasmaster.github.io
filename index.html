<!DOCTYPE HTML>
<html>
    <head>
        <title>Conway's Game of Life</title>
        <style>
            canvas{border-style: groove}
        </style>
        <style>
            button {
                background-color: #112233;
                border: none;
                color: #FFFFFF;
                padding: 0px 8px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 24px;
                margin: 0px 0px;
                cursor: pointer;
            }
            input {
                border: none;
                margin: 0px 0px;
                font-size: 24px;
                height: 100%;
            }
        </style>
    </head>
    <body  style="background-color: #000000; color: white; text-align: center">
        <h1>Conway's Game of Life</h1>
        <canvas id="canvas" width="600" height="600"></canvas>
        <div style="margin: 0 auto; font-size: 0px; background-color: #000000;">
            <div id="main" align="center" style="margin: 0 auto; font-size: 0px; background-color: #112233; width: 500px; border: inset">
                <br>
                    <button type="button" onclick="clear()">Clear</button>
                    <button type="button" onclick="randomize()">Randomize</button>
                    <button type="button" onclick="iterate()">Iterate</button>
                    <button type="button" onclick="skip()">Skip</button>
                    <input type="number" id="skip" min="1" max="200" value="2"></input>
                </br>
                <br>
                    <button type="button" onclick="loop()">Start</button>
                    <button type="button" onclick="stopLoop()">Stop</button>
                    <input type="number" id="UPS" min="1" max="1000" value="30">Max UPS</input>
                    Max UPS
                </br>
                <br>
                    <p id="Running" style="color: #FFFFFF; font-size:24px"></p>
                    <button type="button" onclick="showSettings();">Extra Settings</button>
                </br>
            </div>
            <div id="settings" style="display: none;margin: 0 auto; font-size: 24px; background-color: #112233; width: 450px; border: inset">
                <br align="center" style="text-align:center">
                    <table align="center" style="text-align:center">
                        <tr>
                            <th>Rows</th>
                            <th>Collumns</th>
                            <th>Width</th>
                            <th>Height</th>
                        </tr>
                        <tr>
                            <th><input type="number" id="cols" min="5" max="100" value="60"></input></th>
                            <th><input type="number" id="rows" min="5" max="100" value="60"></input></th>
                            <th><input type="number" id="width" min="100" max="1000" value="600"></input></th>
                            <th><input type="number" id="height" min="100" max="1000" value="600"></input></th>
                    <table>
                    <button type="button" onclick="start()">Confirm</button>
                </br>
            </div>
        </div>
        <!--<button type="button" onclick="settings()">Confirm Settings</button>
        <input type="checkbox" id="wrap">Wrap Around</input>-->

        <script>
            /**************
            **Global*Vars**
            **************/
            var INTERVAL;

            var neighbours = [[-1,-1],[0 ,-1],[1 ,-1],
                              [-1, 0],        [1 , 0],
                              [-1, 1],[0 , 1],[1 , 1]];
            
            var args = {
                circle : true,
                wrap : false,
                colorBG : "#112233",
                colorCell : "#FFFFFF",
                colorGrid : "#000000",
                worldWidth : 60,
                worldHeight : 60,
                canvasWidth : 600,
                canvasHeight : 600
            };
            //World Class
            function wld(){
                this.width = 60;
                this.height = 60;
                this.arr = [];
                this.wrap = false;

                this.setUp = function(){
                    this.arr = [[this.width],[this.height]];
                    this.clear();
                    this.width = args.worldWidth;
                    this.height = args.worldHeight;
                }
                
                this.clear = function(a){
                    for(var i = 0; i < this.width; i++){
                        var a = [];
                        for(var j = 0; j < this.height; j++){
                            a[j] = 0;
                        }
                        this.arr[i] = a;
                    }
                }

                this.randomize = function(){
                    for(var i = 0; i < this.width; i++){
                        var a = [];
                        for(var j = 0; j < this.height; j++){
                            a[j] = Math.floor(Math.random() * (2));
                        }
                        this.arr[i] = a;
                    }
                }

                this.checkNeighbours = function(x,y){
                    var total = 0;

                    for(var i = 0; i < 8; i++){
                        if(x + neighbours[i][0] >= 0 && x + neighbours[i][0] < this.width && y + neighbours[i][1] >= 0 &&  y + neighbours[i][1] < this.width){
                            if(this.arr[x + neighbours[i][0]][y+neighbours[i][1]] != 0){
                                total += 1;
                            }
                        /*Extra Settings*/
                        }
                        /*else if(wrap == true){
                            if(this.arr[x + neighbours[i][0] +this.width % this.width][y+neighbours[i][1] +this.height % this.height] != 0)
                            {
                                total += 1;
                            }
                        }*/

                    }

                    return total;
                }

                this.iterate = function(){
                    var newArr = [[this.width],[this.height]];
                    for (var i = 0; i < this.width; i++){
                        var a = [];
                        for (var j = 0; j < this.height; j++){
                            var n = this.checkNeighbours(i,j);
                            
                                //If cell is populated
                            if(this.arr[i][j] != 0){
                                //If cell has 1 or less neighbours, it dies
                                if(n <= 1){
                                a[j] = 0;
                                //If cell has 4 or more neighbours, it dies from overpopulation
                                }else if(n >= 4){
                                a[j] = 0;
                                }else{
                                a[j] = 1;
                                }
                                //Otherwise the cell stays alive
                            //If the cell is dead but has 3 neighbours exactly, it is reborn
                            }else if(n == 3){a[j] = 1}else{a[j] = 0}
                        }
                        newArr[i] = a;
                    }
                    this.arr = newArr;
                }
            }

            //Canvas Class
            function can(){
                this.width = 600;
                this.height = 600;
                this.canvas;
                this.ctx;

                this.setUp = function(){
                     this.canvas = document.getElementById('canvas');
                     this.ctx = canvas.getContext('2d');
                     this.width = args.canvasWidth;
                     this.height = args.canvasHeight;
                     this.canvas.width = args.canvasWidth;
                     this.canvas.height = args.canvasHeight;
                }
                
                this.clear = function(){
                    this.ctx.fillRect(0,0,this.width,this.height);
                }
                
                this.drawRect = function (x,y,w,h){
                    this.ctx.fillRect(x,y,w,h);
                }

                this.drawCircle = function (x,y,r){
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, r, 0, 2 * Math.PI);
                    this.ctx.fill();
                }

                this.setFillColor = function (color){
                    this.ctx.fillStyle = color;
                }
                this.drawLine = function(x,y,x1,y2){
                    this.ctx.beginPath();
                    this.ctx.moveTo(x,y);
                    this.ctx.lineTo(x1,y2);
                    this.ctx.stroke();
                }
                this.setLineColor = function (color){
                    this.ctx.strokeStyle = color;
                }
            };

            var Canvas = new can();
            var World = new wld();

            /**************
            ***Functions***
            **************/
            function drawGrid(){
                var width = Canvas.width / World.width;
                var height = Canvas.height / World.height;


                Canvas.setFillColor(args.colorBG);
                Canvas.clear();
                for(var i = 0; i < World.width; i++){
                    for(var j = 0; j < World.height; j++){
                        if(World.arr[i][j] == 1){
                            Canvas.setFillColor(args.colorCell); 
                            if(args.circle == false){
                                Canvas.drawRect(i*width,j*height,width,height);
                            }else{
                                Canvas.drawCircle(i*width + (width/2),j*height + (width/2),(width/2)-2);
                            }
                        }
                    }
                }

                //To fix for overlaps
                Canvas.setLineColor(args.colorGrid);
                for(var i = 0; i < World.width; i++){
                    for(var j = 0; j < World.height; j++){
                        Canvas.drawLine(j*width,0,j*width,Canvas.height);
                        Canvas.drawLine(0,i*width,Canvas.height,i*width);
                    }
                }
            }
            function randomize(){
                World.randomize();
                drawGrid();
            }

            function iterate(){
                World.iterate();
                drawGrid();
            }

            function skip(){
                var t = document.getElementById('skip').value;
                for (var i = 0; i < parseInt(t); i++){
                    World.iterate();
                }
                drawGrid();
            }

            function clear(){
                World.clear();
                drawGrid();
            }

            function settings(){
                //World.wrap = true;
            }

            function loop(){
                var ups = document.getElementById("UPS").value;
                document.getElementById("Running").innerHTML = "Running!";
                if(INTERVAL != undefined){
                    clearInterval(INTERVAL);
                    INTERVAL = setInterval(iterate,1000/ups);
                    }else{
                    INTERVAL = setInterval(iterate,1000/ups);
                }
            }

            function stopLoop(){
                document.getElementById("Running").innerHTML = "Stopped!";
                clearInterval(INTERVAL);
            }

            function showSettings(){
                var div = document.getElementById("settings");
                if(div.style.display != "none"){
                    div.style.display = "none";
                }else{
                    div.style.display = "block";
                }
            }

            function start(){
                args.canvasWidth = document.getElementById("width").value;
                args.canvasHeight = document.getElementById("height").value;
                args.worldWidth = document.getElementById("cols").value;
                args.worldHeight = document.getElementById("rows").value;
                
                Canvas.setUp();
                World.setUp();
                drawGrid();
            }

            //Events
            document.getElementById('canvas').addEventListener('click',function(e){
                var width = Canvas.width / World.width;
                var height = Canvas.height / World.height;
                var x =  ~~(e.offsetX / width);
                var y = ~~(e.offsetY / height);
                World.arr[x][y] = !World.arr[x][y];
                drawGrid();
            },false);

            //Start
            start();
        </script>

    </body>
</html>